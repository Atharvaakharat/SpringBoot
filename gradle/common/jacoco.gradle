jacoco {
    toolVersion = '0.8.10'
}

test {
    jacoco {
        enabled = true
    }
    finalizedBy jacocoTestReport
}
check.dependsOn jacocoTestCoverageVerification
jacocoTestReport {
    dependsOn test

    reports {
        xml.required = true
        html.required = true
        csv.required = false
    }
afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it,
                    excludes: ['**/org/example/entity/**',
                              '**/org/example/exception/**',
                              '**/org/example/security/**'])
        }))
    }
   finalizedBy jacocoTestCoverageVerification
}
jacocoTestCoverageVerification {
    violationRules {

        rule {
            element = 'CLASS'
            limit {
                counter = 'LINE'
                value = 'COVEREDRATIO'
                minimum = 0.60
            }
            excludes= ['org.example.entity.*',
                       'org.example.exception.*',
                       'org.example.security.*',
                       'org.example.Main']
        }
    }
}
